{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["(function(e, a) { for(var i in a) e[i] = a[i]; }(exports, /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 1);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\n\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar DefaultProvider = /** @class */ (function () {\n    function DefaultProvider() {\n        this.provider = this.getDefaultProvider();\n    }\n    DefaultProvider.prototype.request = function (params) {\n        var fn = this.provider && this.provider.request;\n        return this.promisify(fn, params);\n    };\n    DefaultProvider.prototype.getStorageInfo = function () {\n        var fn = this.provider && this.provider.getStorageInfo;\n        return this.promisify(fn);\n    };\n    DefaultProvider.prototype.removeStorage = function (params) {\n        var fn = this.provider && this.provider.removeStorage;\n        return this.promisify(fn, params);\n    };\n    DefaultProvider.prototype.getExtConfig = function () {\n        var fn = this.provider && this.provider.getExtConfig;\n        return this.promisify(fn);\n    };\n    DefaultProvider.prototype.setStorage = function (params) {\n        var fn = this.provider && this.provider.setStorage;\n        return this.promisify(fn, params);\n    };\n    DefaultProvider.prototype.getStorage = function (params) {\n        var fn = this.provider && this.provider.getStorage;\n        return this.promisify(fn, params);\n    };\n    DefaultProvider.prototype.getStorageSync = function (key) {\n        var fn = this.provider && this.provider.getStorageSync;\n        return fn(key);\n    };\n    DefaultProvider.prototype.getCurrentPages = function () {\n        var fn = this.provider && this.provider.getCurrentPages;\n        fn = fn || getCurrentPages;\n        return fn();\n    };\n    DefaultProvider.prototype.getDefaultProvider = function () {\n        /* tslint:disable */\n        try {\n            if (Taro !== undefined) {\n                return Taro;\n            }\n        }\n        catch (error) { }\n        try {\n            if (wx !== undefined) {\n                return wx;\n            }\n        }\n        catch (error) { }\n        try {\n            if (my !== undefined) {\n                return my;\n            }\n        }\n        catch (error) { }\n        try {\n            if (tt !== undefined) {\n                return tt;\n            }\n        }\n        catch (error) { }\n        try {\n            if (swan !== undefined) {\n                return swan;\n            }\n        }\n        catch (error) { }\n    };\n    DefaultProvider.prototype.promisify = function (fn, params) {\n        if (typeof fn !== \"function\") {\n            throw new TypeError(\"Invalid provider type.\");\n        }\n        params = Object.assign({}, params);\n        return new Promise(function (success, fail) { return fn(__assign({}, params, { success: success, fail: fail })); });\n    };\n    return DefaultProvider;\n}());\nexports.DefaultProvider = DefaultProvider;\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar i18n_1 = __webpack_require__(2);\nvar i18n = new i18n_1.I18n();\nexports.i18n = i18n;\nvar provider_1 = __webpack_require__(0);\nexports.DefaultProvider = provider_1.DefaultProvider;\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar config_1 = __webpack_require__(3);\nvar store_1 = __webpack_require__(4);\nvar util_1 = __webpack_require__(5);\nvar config;\nvar store;\nvar util;\nvar userLanguage;\nvar I18n = /** @class */ (function () {\n    function I18n(options) {\n        this.config(options);\n    }\n    Object.defineProperty(I18n.prototype, \"language\", {\n        /**\n         * Get current language\n         */\n        get: function () {\n            var rememberLanguage = config.rememberLanguage, languageStorageKey = config.languageStorageKey, provider = config.provider;\n            if (rememberLanguage && languageStorageKey) {\n                if (userLanguage) {\n                    return userLanguage;\n                }\n                else {\n                    var lang = provider.getStorageSync(config.languageStorageKey);\n                    if (lang) {\n                        return userLanguage = lang;\n                    }\n                }\n            }\n            return config.lang;\n        },\n        /**\n         * Set current language\n         */\n        set: function (lang) {\n            config.lang = lang;\n            var rememberLanguage = config.rememberLanguage, languageStorageKey = config.languageStorageKey, provider = config.provider;\n            if (rememberLanguage && languageStorageKey) {\n                userLanguage = lang;\n                provider.setStorage({ key: languageStorageKey, data: lang });\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * Configure i18n options\n     * @param options\n     */\n    I18n.prototype.config = function (options) {\n        config = Object.assign(config_1.defaultConfig, options);\n        store = new store_1.I18nStore(config);\n        util = new util_1.Util(config);\n    };\n    /**\n     * Get index resource.\n     */\n    I18n.prototype.getIndex = function (force) {\n        var _this = this;\n        var indexUrl = config.indexUrl, cachable = config.cachable;\n        if (!cachable || force) {\n            if (!util.isFn(indexUrl)) {\n                throw new Error(\"Please configure the 'indexUrl' option first.\");\n            }\n            var url = indexUrl();\n            if (this.getIndex.prototype.promise) {\n                return this.getIndex.prototype.promise;\n            }\n            util.debug(\"Getting index resource from remote\");\n            var clear_1 = function () { return _this.getIndex.prototype.promise = undefined; };\n            var promise = util.request(url)\n                .then(function (data) { return store.clear(data); })\n                .then(function (data) { return (clear_1(), data); }, function (error) { return (clear_1(), Promise.reject(error)); });\n            return this.getIndex.prototype.promise = promise;\n        }\n        else {\n            util.debug(\"Trying get index resource from local\");\n            return Promise.resolve(this.getIndex.prototype.data)\n                .then(function (data) { return data || _this.getIndex(true); })\n                .then(function (data) { return _this.getIndex.prototype.data = data; });\n        }\n    };\n    /**\n     * Get text resources\n     * @param options options\n     */\n    I18n.prototype.getTexts = function (options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        var texts = options.texts;\n        if (texts) {\n            util.debug(\"Use local texts\", texts);\n            return Promise.resolve(this.mergeTexts(texts));\n        }\n        var textsUrl = config.textsUrl, cachable = config.cachable;\n        if (!util.isFn(textsUrl)) {\n            throw new Error(\"Please configure the 'textsUrl' option first.\");\n        }\n        var path = options.path || util.getCurrentPageRoute();\n        util.debug(\"Current i18n path is \" + path);\n        if (typeof path !== \"string\") {\n            throw new TypeError(\"The path must be string type.\");\n        }\n        return this.getIndex()\n            .then(function (resources) { return resources[path]; })\n            .then(function (hash) {\n            if (!hash) {\n                return Promise.reject(new Error(\"The path '\" + path + \"' was not defined in index file.\"));\n            }\n            var url = textsUrl(path, hash);\n            if (cachable) {\n                return store.get(path).then(function (data) {\n                    if (data && data.version === hash) {\n                        util.debug(\"Getting text resource from cache.\");\n                        return data;\n                    }\n                    else {\n                        if (!data) {\n                            util.debug(\"The cache resource not exists and getting text resource from remote\");\n                        }\n                        else {\n                            store.remove(path);\n                            util.debug(\"The cache resource has expired.\");\n                        }\n                        return util.request(url)\n                            .then(function (res) { return (res.version = hash, res); })\n                            .then(function (t) { return (store.set(path, t), t); });\n                    }\n                });\n            }\n            else {\n                util.debug(\"Getting text resource from remote\");\n                return util.request(url);\n            }\n        })\n            .then(function (t) { return _this.mergeTexts(t); });\n    };\n    /**\n     * Merge texts\n     * @param data multi-language texts\n     * @param lang language\n     *\n     * mergetTexts({zh:{hi:'你好'},en:{hi:'Hi'}},'en')\n     * result: {hi:'Hi'}\n     */\n    I18n.prototype.mergeTexts = function (data, lang) {\n        if (!data) {\n            return {};\n        }\n        var language = lang || this.language;\n        if (!(language in data)) {\n            util.debug(\"The resource corresponding to \" + language + \" does not exist.\", data);\n        }\n        return data[language];\n    };\n    return I18n;\n}());\nexports.I18n = I18n;\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar provider_1 = __webpack_require__(0);\nexports.defaultConfig = {\n    cachable: true,\n    debug: false,\n    lang: \"zh_CN\",\n    languageStorageKey: \"i18n_language\",\n    provider: new provider_1.DefaultProvider(),\n    rememberLanguage: true,\n    storageKeyPrefix: \"i18n\",\n};\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar I18nStore = /** @class */ (function () {\n    function I18nStore(config) {\n        this.prefix = config.storageKeyPrefix;\n        this.provider = config.provider;\n        this.languageKey = config.languageStorageKey;\n    }\n    I18nStore.prototype.get = function (path) {\n        var key = this.getKey(path);\n        return this.provider.getStorage({ key: key })\n            .then(function (res) { return res.data; })\n            .catch(function () { return null; });\n    };\n    I18nStore.prototype.set = function (path, data) {\n        var key = this.getKey(path);\n        return this.provider.setStorage({ key: key, data: data });\n    };\n    I18nStore.prototype.has = function (path) {\n        var key = this.getKey(path);\n        return this.provider.getStorageInfo()\n            .then(function (res) { return res.keys.indexOf(key) >= 0; })\n            .catch(function () { return false; });\n    };\n    I18nStore.prototype.remove = function (path) {\n        var key = this.getKey(path);\n        return this.provider.removeStorage({ key: key });\n    };\n    I18nStore.prototype.getAll = function () {\n        var _this = this;\n        if (!this.prefix) {\n            return Promise.reject(new Error(\"missing i18n configuration option 'storageKeyPrefix'\"));\n        }\n        return this.provider.getStorageInfo()\n            .then(function (info) { return info.keys; })\n            .then(function (keys) { return keys.filter(function (key) { return key.startsWith(_this.prefix); }); });\n    };\n    I18nStore.prototype.clear = function (data) {\n        var _this = this;\n        var from = this.getKey(\"\").length;\n        this.getAll()\n            .then(function (keys) { return keys.filter(function (key) { return key !== _this.languageKey && !(key.substr(from) in data); }); })\n            .then(function (keys) { return keys.forEach(function (key) { return _this.provider.removeStorage({ key: key }); }); })\n            .catch(console.error);\n        return data;\n    };\n    I18nStore.prototype.getKey = function (path) {\n        return this.prefix + \"/\" + path;\n    };\n    return I18nStore;\n}());\nexports.I18nStore = I18nStore;\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util = /** @class */ (function () {\n    function Util(config) {\n        this.config = config;\n    }\n    Util.prototype.getCurrentPageRoute = function () {\n        var pages = this.config.provider.getCurrentPages();\n        var currentPage = pages[pages.length - 1];\n        return currentPage.route;\n    };\n    Util.prototype.request = function (url) {\n        this.debug(\"i18n request url: \" + url);\n        return this.config.provider.request({ url: url })\n            .then(function (res) { return (res.statusCode === 200 ? res.data : Promise.reject()); })\n            .then(function (data) {\n            if (typeof data === \"object\") {\n                return data;\n            }\n            return Promise.reject(new Error(\"invalid i18n config file, please check file contents.\"));\n        });\n    };\n    Util.prototype.debug = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        if (this.config.debug) {\n            console.log.apply(console, args);\n        }\n    };\n    Util.prototype.isFn = function (fn) {\n        return typeof fn === \"function\";\n    };\n    return Util;\n}());\nexports.Util = Util;\n\n\n/***/ })\n/******/ ])));\n//# sourceMappingURL=index.js.map"]}